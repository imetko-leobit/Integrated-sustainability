(()=>{"use strict";var e={"./src/scripts/modules/FilterHandler.js":(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,a(n.key),n)}}function a(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}r.r(t),r.d(t,{default:()=>l});const l=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.form=document.querySelector(t),this.form&&(this.container=document.querySelector(".publications"),this.loader=document.querySelector(".loader"),this.postType=this.form.dataset.postType,this.searchResultsTitle=document.querySelector(".js-search-results-title"),this.filterFormWrapper=document.querySelector(".block-filter-form"),this.btnOpen=document.querySelector(".filter-button--open"),this.btnClose=document.querySelector(".filter-button--close"),this.excludedIds=[],this.currentPage=1,this.hasMore=!0,this.isLoading=!1,this.filterTimeout=null,this.hasFilters=!1,this.totalResults=0,this.searchQuery="",this.choicesInstances=[],this.init())},t=[{key:"init",value:function(){var e=this;this.initializeChoices(),this.initializeFilterButtons(),this.form.querySelectorAll("input, select").forEach((function(t){"SELECT"===t.tagName?t.addEventListener("change",(function(){return e.handleFilterChange()})):t.addEventListener("input",(function(){return e.handleFilterChange()}))})),this.loadPosts(!0)}},{key:"initializeChoices",value:function(){var e=this;"undefined"!=typeof Choices&&(this.form.querySelectorAll(".regular-select").forEach((function(t){var r=new Choices(t,{removeItemButton:!0,placeholder:!0,maxItemCount:5,itemSelectText:"",searchEnabled:!1});e.choicesInstances.push(r)})),this.form.querySelectorAll(".regular-select-clearable").forEach((function(t){var r=new Choices(t,{removeItemButton:!0,shouldSort:!1,placeholder:!0,placeholderValue:null,searchPlaceholderValue:null,maxItemCount:5,itemSelectText:"",searchEnabled:!1,allowHTML:!0});e.choicesInstances.push(r)})))}},{key:"initializeFilterButtons",value:function(){var e=this;this.btnOpen&&this.filterFormWrapper&&this.btnOpen.addEventListener("click",(function(t){t.preventDefault(),e.filterFormWrapper.classList.add("is-open")})),this.btnClose&&this.filterFormWrapper&&this.btnClose.addEventListener("click",(function(t){t.preventDefault(),e.filterFormWrapper.classList.remove("is-open")}))}},{key:"updateSearchResultsTitle",value:function(){var e;if(this.searchResultsTitle){var t=this.form.querySelector('input[name="s"]'),r=(null==t||null===(e=t.value)||void 0===e?void 0:e.trim())||"";if(r){var n=this.searchResultsTitle.dataset.titleText||"search results for",i="".concat(this.totalResults," ").concat(n,' "').concat(r,'"');this.searchResultsTitle.textContent=i,this.searchResultsTitle.style.display="block"}else this.searchResultsTitle.textContent="",this.searchResultsTitle.style.display="none"}}},{key:"handleFilterChange",value:function(){var e=this;clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout((function(){e.applyFilters()}),2e3)}},{key:"applyFilters",value:function(){this.excludedIds=[],this.currentPage=1,this.hasMore=!0,this.totalResults=0,this.container&&(this.container.innerHTML=""),this.hasFilters=this.checkIfFiltersActive(),this.loadPosts(!0)}},{key:"checkIfFiltersActive",value:function(){var e=new FormData(this.form),t=e.get("s");if(t&&t.trim())return!0;for(var r=0,n=["locations","industry_categories","service_categories","project_tags"];r<n.length;r++){var i=n[r];if(e.getAll("".concat(i,"[]")).filter((function(e){return e&&e.trim()})).length>0)return!0}var o=e.get("rank");return!(!o||!o.trim())}},{key:"loadPosts",value:function(){var e,t,r=this;if(!this.isLoading&&this.hasMore){this.isLoading=!0,this.showLoader();var n=new FormData(this.form),i={action:"load_filtered_posts",nonce:(null===(e=window.filterPostsData)||void 0===e?void 0:e.nonce)||"",post_type:this.postType,page:this.currentPage,has_filters:this.hasFilters,s:n.get("s")||"",rank:n.get("rank")||""},o=new URLSearchParams;o.append("action",i.action),o.append("nonce",i.nonce),o.append("post_type",i.post_type),o.append("page",i.page),o.append("has_filters",i.has_filters),o.append("s",i.s),o.append("rank",i.rank),this.excludedIds.forEach((function(e){o.append("excluded_ids[]",e)})),n.getAll("locations[]").filter((function(e){return e})).forEach((function(e){return o.append("locations[]",e)})),n.getAll("industry_categories[]").filter((function(e){return e})).forEach((function(e){return o.append("industry_categories[]",e)})),n.getAll("service_categories[]").filter((function(e){return e})).forEach((function(e){return o.append("service_categories[]",e)})),n.getAll("project_tags[]").filter((function(e){return e})).forEach((function(e){return o.append("project_tags[]",e)})),fetch((null===(t=window.filterPostsData)||void 0===t?void 0:t.ajaxUrl)||"/wp-admin/admin-ajax.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o}).then((function(e){return e.json()})).then((function(e){e.success&&r.handleSuccess(e.data)})).catch((function(e){})).finally((function(){r.isLoading=!1,r.hideLoader()}))}}},{key:"handleSuccess",value:function(e){var t;this.container&&e.html&&this.container.insertAdjacentHTML("beforeend",e.html),e.post_ids&&e.post_ids.length>0&&(t=this.excludedIds).push.apply(t,i(e.post_ids)),this.hasMore=e.has_more||!1,1===this.currentPage&&(void 0!==e.total_results?this.totalResults=e.total_results:e.post_ids&&e.post_ids.length>0&&(this.totalResults=e.post_ids.length)),this.updateSearchResultsTitle(),this.hasMore&&this.currentPage++;var r=new CustomEvent("postsLoaded",{detail:{hasMore:this.hasMore,page:this.currentPage}});document.dispatchEvent(r)}},{key:"showLoader",value:function(){this.loader&&(this.loader.style.display="block")}},{key:"hideLoader",value:function(){this.loader&&(this.loader.style.display="none")}},{key:"loadMore",value:function(){!this.isLoading&&this.hasMore&&this.loadPosts()}}],t&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()},"./src/scripts/modules/InfiniteScroll.js":(e,t,r)=>{function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function o(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}r.r(t),r.d(t,{default:()=>s});const s=function(){return e=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.trigger=document.querySelector(t),this.filter=r,this.trigger&&this.filter&&(this.observer=null,this.init())},t=[{key:"init",value:function(){var e=this;this.observer=new IntersectionObserver((function(t){return e.handleIntersection(t)}),{root:null,rootMargin:"100px",threshold:.1}),this.observer.observe(this.trigger),document.addEventListener("postsLoaded",(function(t){e.handlePostsLoaded(t.detail)}))}},{key:"handleIntersection",value:function(e){var t=this;e.forEach((function(e){e.isIntersecting&&!t.filter.isLoading&&t.filter.hasMore&&t.filter.loadMore()}))}},{key:"handlePostsLoaded",value:function(e){e.hasMore||this.destroy()}},{key:"destroy",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null)}}],t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}()}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{r.r(n);var e=r("./src/scripts/modules/FilterHandler.js"),t=r("./src/scripts/modules/InfiniteScroll.js");document.addEventListener("DOMContentLoaded",(function(){if(document.querySelector(".filter-form")){var r=new e.default(".filter-form");new t.default(".scroll-trigger",r)}var n=document.querySelector(".js-publications-timer");if(n){var i=Array.from(n.querySelectorAll(".post-card")),o=-1,s=null,a=!1,l=function(){if(0===(i=Array.from(n.querySelectorAll(".post-card"))).length)return h(),void(o=-1);o>=i.length&&(o=-1)},c=function(){0!==i.length&&(i.forEach((function(e){return e.classList.remove("is-active")})),o=(o+1)%i.length,i[o].classList.add("is-active"))},u=function(){!s&&i.length>0&&(s=setInterval(c,5e3))},h=function(){clearInterval(s),s=null,i.forEach((function(e){return e.classList.remove("is-active")}))};new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting?(a=!0,u(),-1===o&&c()):(a=!1,h())}))}),{threshold:.3}).observe(n),n.addEventListener("mouseenter",h),n.addEventListener("mouseleave",u),document.addEventListener("postsLoaded",(function(){l(),a&&-1===o&&(c(),u())})),new MutationObserver((function(){l(),a&&-1===o&&(c(),u())})).observe(n,{childList:!0,subtree:!0})}}))})()})();