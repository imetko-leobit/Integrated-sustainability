(()=>{"use strict";var t={"./src/scripts/modules/FilterHandler.js":(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,a(n.key),n)}}function a(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}r.r(e),r.d(e,{default:()=>l});const l=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.form=document.querySelector(e),this.form&&(this.container=document.querySelector(".publications"),this.loader=document.querySelector(".loader"),this.postType=this.form.dataset.postType,this.excludedIds=[],this.currentPage=1,this.hasMore=!0,this.isLoading=!1,this.filterTimeout=null,this.hasFilters=!1,this.init())},(e=[{key:"init",value:function(){var t=this;this.form.querySelectorAll("input, select").forEach((function(e){"SELECT"===e.tagName?e.addEventListener("change",(function(){return t.handleFilterChange()})):e.addEventListener("input",(function(){return t.handleFilterChange()}))})),this.loadPosts(!0)}},{key:"handleFilterChange",value:function(){var t=this;clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout((function(){t.applyFilters()}),2e3)}},{key:"applyFilters",value:function(){this.excludedIds=[],this.currentPage=1,this.hasMore=!0,this.container&&(this.container.innerHTML=""),this.hasFilters=this.checkIfFiltersActive(),this.loadPosts(!0)}},{key:"checkIfFiltersActive",value:function(){var t,e=new FormData(this.form);if(null!==(t=e.get("s"))&&void 0!==t&&t.trim())return!0;for(var r=0,n=["locations","industries","project_services","project_tags"];r<n.length;r++){var o=n[r];if(e.getAll("".concat(o,"[]")).filter((function(t){return t})).length>0)return!0}return!!e.get("rank")}},{key:"loadPosts",value:function(){var t,e,r=this;if(!this.isLoading&&this.hasMore){this.isLoading=!0,this.showLoader();var n=new FormData(this.form),o={action:"load_filtered_posts",nonce:(null===(t=window.filterPostsData)||void 0===t?void 0:t.nonce)||"",post_type:this.postType,page:this.currentPage,has_filters:this.hasFilters,s:n.get("s")||"",rank:n.get("rank")||""},i=new URLSearchParams;i.append("action",o.action),i.append("nonce",o.nonce),i.append("post_type",o.post_type),i.append("page",o.page),i.append("has_filters",o.has_filters),i.append("s",o.s),i.append("rank",o.rank),this.excludedIds.forEach((function(t){i.append("excluded_ids[]",t)})),n.getAll("locations[]").filter((function(t){return t})).forEach((function(t){return i.append("locations[]",t)})),n.getAll("industries[]").filter((function(t){return t})).forEach((function(t){return i.append("industries[]",t)})),n.getAll("project_services[]").filter((function(t){return t})).forEach((function(t){return i.append("project_services[]",t)})),n.getAll("project_tags[]").filter((function(t){return t})).forEach((function(t){return i.append("project_tags[]",t)})),fetch((null===(e=window.filterPostsData)||void 0===e?void 0:e.ajaxUrl)||"/wp-admin/admin-ajax.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i}).then((function(t){return t.json()})).then((function(t){t.success&&r.handleSuccess(t.data)})).catch((function(t){})).finally((function(){r.isLoading=!1,r.hideLoader()}))}}},{key:"handleSuccess",value:function(t){var e;this.container&&t.html&&this.container.insertAdjacentHTML("beforeend",t.html),t.post_ids&&t.post_ids.length>0&&(e=this.excludedIds).push.apply(e,o(t.post_ids)),this.hasMore=t.has_more||!1,this.hasMore&&this.currentPage++;var r=new CustomEvent("postsLoaded",{detail:{hasMore:this.hasMore,page:this.currentPage}});document.dispatchEvent(r)}},{key:"showLoader",value:function(){this.loader&&(this.loader.style.display="block")}},{key:"hideLoader",value:function(){this.loader&&(this.loader.style.display="none")}},{key:"loadMore",value:function(){!this.isLoading&&this.hasMore&&this.loadPosts()}}])&&s(t.prototype,e),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}()},"./src/scripts/modules/InfiniteScroll.js":(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,i(n.key),n)}}function i(t){var e=function(t,e){if("object"!=n(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,e||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==n(e)?e:e+""}r.r(e),r.d(e,{default:()=>s});const s=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.trigger=document.querySelector(e),this.filter=r,this.trigger&&this.filter&&(this.observer=null,this.init())},e=[{key:"init",value:function(){var t=this;this.observer=new IntersectionObserver((function(e){return t.handleIntersection(e)}),{root:null,rootMargin:"100px",threshold:.1}),this.observer.observe(this.trigger),document.addEventListener("postsLoaded",(function(e){t.handlePostsLoaded(e.detail)}))}},{key:"handleIntersection",value:function(t){var e=this;t.forEach((function(t){t.isIntersecting&&!e.filter.isLoading&&e.filter.hasMore&&e.filter.loadMore()}))}},{key:"handlePostsLoaded",value:function(t){t.hasMore||this.destroy()}},{key:"destroy",value:function(){this.observer&&(this.observer.disconnect(),this.observer=null)}}],e&&o(t.prototype,e),r&&o(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}()}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{r.r(n);var t=r("./src/scripts/modules/FilterHandler.js"),e=r("./src/scripts/modules/InfiniteScroll.js");document.addEventListener("DOMContentLoaded",(function(){if(document.querySelector(".posts-filter-form")){var r=new t.default(".posts-filter-form");new e.default(".scroll-trigger",r)}}))})()})();